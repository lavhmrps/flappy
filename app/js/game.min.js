!function(){function t(t){switch(v){case q.Splash:u&&(N.reset(),v=q.Game,C.jump());break;case q.Game:C.jump();break;case q.Score:if(70>b)return;var e=t.offsetX,i=t.offsetY;u&&e>c.x&&e<c.x+c.width&&i>c.y&&i<c.y+c.height&&(v=q.Splash,T.play(),F.reset())}}function e(){n=document.getElementById("container"),o=document.getElementById("flappyCanvas"),o.addEventListener("mouseover",function(){u=!0}),o.addEventListener("mouseout",function(){u=!1}),h=window.innerWidth,d=window.innerHeight;var e="touchstart";h>=500&&(h=320,d=1.5*h,e="mousedown"),document.addEventListener(e,t),o.style.border="thin solid black",o.width=h,o.height=d,r=o.getContext("2d"),v=q.Splash;var s=new Image;s.src="res/sheet.png",s.onload=function(){initSprites(this),r.fillStyle=s_bg.color,i(),c={x:(h-s_buttons.Ok.width)/2,y:d-180,height:s_buttons.Ok.height,width:s_buttons.Ok.width}};for(var a=0;H>a;a++)O[a]=new Audio("sfx/sfx_wing.ogg"),I[a]=new Audio("sfx/sfx_point.ogg"),O[a].volume=.1,I[a].volume=.1;T.volume=.1,G.volume=.1,B.volume=.1}function i(){var t=function(){s(),a(),window.requestAnimationFrame(t,o)};window.requestAnimationFrame(t,o)}function s(){b++,v!==q.Score&&(f=(f-2)%16),v===q.Game&&F.update(),C.update()}function a(){r.fillRect(0,0,h,d),r.stroke(),s_bg.draw(r,0,d-s_bg.height),s_bg.draw(r,s_bg.width,d-s_bg.height),F.draw(r),C.draw(r),s_fg.draw(r,f,d-s_fg.height),s_fg.draw(r,f+s_fg.width,d-s_fg.height);var t=h/2,e=d/2,i=y.toString().length,s=R.toString().length,a=x.toString().length;if(v===q.Game&&s_numberB.draw(r,h/2-s_numberB.width*i/2,20,y),v===q.Splash&&(s_text.GetReady.draw(r,t-s_text.GetReady.width/2,d-380),s_splash.draw(r,t-s_splash.width/2,e-s_splash.height/2)),v===q.Score){var n=80,o=150,u=35,l=58,m=75,p=y>x,w=0,g=74,_=192;if(y>9&&20>y&&(w=L.bronze),y>19&&30>y&&(w=L.silver),y>29&&40>y&&(w=L.gold),y>39&&(w=L.platinum),A||(s_numberB.draw(r,h/2-s_numberB.width*i/2,20,y),setTimeout(function(){A=!0},200)),P||(s_numberB.draw(r,h/2-s_numberB.width*i/2,20,y),setTimeout(function(){P=!0},1e3)),A&&(j+=.2,j<Math.PI?s_text.GameOver.draw(r,t-s_text.GameOver.width/2,n-5*Math.sin(j)):s_text.GameOver.draw(r,t-s_text.GameOver.width/2,n)),P)if(z+=4,50>z)switch(T.play(),s_score.draw(r,t-s_score.width/2,o+50-z),s_numberS.draw(r,250-s_numberS.width*i,o+85-z,0),s_numberS.draw(r,250-s_numberS.width*a,o+125-z,x),s_buttons.Ok.draw(r,t-s_buttons.Ok.width/2,d-130-z),p&&s_new.draw(r,180,o+l+50-z),w){case L.bronze:s_medal.bronze.draw(r,g,_+50-z);break;case L.silver:s_medal.silver.draw(r,g,_+50-z);break;case L.gold:s_medal.gold.draw(r,g,_+50-z);break;case L.platinum:s_medal.platinum.draw(r,g,_+50-z)}else switch(b%2==0&&(R=R++<y?R:y),s_score.draw(r,t-s_score.width/2,o),s_numberS.draw(r,250-s_numberS.width*s,o+u,R),s_numberS.draw(r,250-s_numberS.width*a,o+m,x),s_buttons.Ok.draw(r,t-s_buttons.Ok.width/2,d-180),p&&s_new.draw(r,180,o+l),w){case L.bronze:s_medal.bronze.draw(r,g,_);break;case L.silver:s_medal.silver.draw(r,g,_);break;case L.gold:s_medal.gold.draw(r,g,_);break;case L.platinum:s_medal.platinum.draw(r,g,_)}}}var n,r,o,h,d,u,l,m,p,w,g,_,c,v,f=0,b=0,y=0,x=0,S=0,M=80,k=70,E=3,L={none:0,bronze:1,silver:2,gold:3,platinum:4},B=new Audio("sfx/sfx_die.ogg"),G=new Audio("sfx/sfx_hit.ogg"),I=[],T=new Audio("sfx/sfx_swoosh.ogg"),O=[],H=6,A=!1,P=!1,j=0,z=0,R=0,q={Splash:0,Game:1,Score:2},C={x:60,y:0,frame:0,animation:[0,1,2,1],radius:10,rotation:0,velocity:0,gravity:.25,_jump:5,jump:function(){this.velocity=-this._jump,O[S++%H].play()},update:function(){var t=v===q.Splash?10:5;this.frame+=b%t===0?1:0,this.frame%=this.animation.length,v===q.Splash?(this.y=d-280+5*Math.sin(b/t),this.rotation=0):(this.velocity+=this.gravity,this.y+=this.velocity,this.y>=d-(s_fg.height+C.radius)&&(this.y=d-(s_fg.height+C.radius),v===q.Game&&(G.play(),b=0,v=q.Score)),this.velocity>=this._jump?(this.frame=1,this.rotation=Math.min(Math.PI/2,this.rotation),this.rotation+=.1):this.rotation=-.3)},draw:function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);var e=this.animation[this.frame];s_bird[e].draw(t,-s_bird[e].width/2,-s_bird[e].height/2),t.restore()}},F={_pipes:[],reset:function(){this._pipes=[]},update:function(){var t=Math.round(M)/2;if(0===Math.floor(b%(60/k))){var e=Math.random();e=e.toString().charAt(e.toString().length-1)%2==0?e:-1*e;var i=d-(1.5*s_pipeSouth.height+1.3*s_fg.height-50-(160-t)*e);this._pipes.push({x:h,y:i,width:s_pipeSouth.width,height:s_pipeSouth.height,passed:!1})}for(var s=0,a=this._pipes.length;a>s;s++){var n=this._pipes[s];if(n.x-=E,0===s){var r=Math.min(Math.max(C.x,n.x),n.x+n.width),o=Math.min(Math.max(C.y,n.y),n.y-t+n.height),u=Math.min(Math.max(C.y,n.y+n.height+t),n.y+2*n.height+t),l=C.x-r,m=C.y-o,p=C.y-u,w=l*l+m*m,g=l*l+p*p,_=C.radius*C.radius;(_>w||_>g)&&(v=q.Score,G.play(),setTimeout(function(){B.play()},400),b=0),n.x+n.width/2<=C.x&&!n.passed&&(I[y%H].play(),n.passed=!0,++y)}n.x<-n.width&&(this._pipes.splice(s,1),s--,a--)}},draw:function(t){t.save();for(var e=0,i=this._pipes.length;i>e;e++){var s=this._pipes[e],a=Math.round(M)/2;s_pipeSouth.draw(t,s.x,s.y-a),s_pipeNorth.draw(t,s.x,s.y+a+s.height)}t.restore()}},N={reset:function(){localStorage.setItem("highscore",Math.max(x,y)||0),x=localStorage.getItem("highscore"),y=0,b=0,A=!1,P=!1,z=0,j=0,R=0}};e(),l=document.getElementById("inputPipeGap"),m=document.getElementById("inputPipePeriod"),p=document.getElementById("inputSpeed"),btnReset=document.getElementById("btnReset"),w=document.getElementById("outputPipeGap"),_=document.getElementById("outputPipePeriod"),g=document.getElementById("outputSpeed"),w.innerHTML=l.value,_.innerHTML=m.value,g.innerHTML=p.value,M=l.value,k=m.value,E=p.value,l.addEventListener("input",function(){w.innerHTML=this.value,M=this.value}),m.addEventListener("input",function(){_.innerHTML=this.value,k=this.value}),p.addEventListener("input",function(){g.innerHTML=this.value,E=this.value}),btnReset.addEventListener("click",function(){l.value=80,w.innerHTML=l.value,M=80,m.value=.7,_.innerHTML=m.value,k=.7,p.value=2,g.innerHTML=p.value,E=2})}();