!function(){function t(t){switch(m){case j.Splash:O.reset(),m=j.Game,z.jump();break;case j.Game:z.jump();break;case j.Score:m=j.Splash,y.play(),I.reset()}}function e(){r=document.getElementById("container"),n=document.createElement("canvas"),o=window.innerWidth,d=window.innerHeight;var e="touchstart";o>=500&&(o=320,d=1.5*o,e="mousedown"),document.addEventListener(e,t),n.style.border="thin solid black",n.width=o,n.height=d,h=n.getContext("2d"),r.appendChild(n),m=j.Splash;var s=new Image;s.src="res/sheet.png",s.onload=function(){initSprites(this),h.fillStyle=s_bg.color,i()};for(var a=0;S>a;a++)x[a]=new Audio("sfx/sfx_wing.ogg"),x[a].volume=.1;y.volume=.1,v.volume=.1,f.volume=.1,b.volume=.1}function i(){var t=function(){s(),a(),window.requestAnimationFrame(t,n)};window.requestAnimationFrame(t,n)}function s(){u++,m!==j.Score&&(l=(l-2)%16),m===j.Game&&I.update(),z.update()}function a(){h.fillRect(0,0,o,d),h.stroke(),s_bg.draw(h,0,d-s_bg.height),s_bg.draw(h,s_bg.width,d-s_bg.height),I.draw(h),z.draw(h),s_fg.draw(h,l,d-s_fg.height),s_fg.draw(h,l+s_fg.width,d-s_fg.height);var t=o/2,e=d/2,i=w.toString().length,s=B.toString().length,a=_.toString().length;if(m===j.Game&&s_numberB.draw(h,o/2-s_numberB.width*i/2,20,w),m===j.Splash&&(s_text.GetReady.draw(h,t-s_text.GetReady.width/2,d-380),s_splash.draw(h,t-s_splash.width/2,e-s_splash.height/2)),m===j.Score){var r=80,n=150,g=35,p=75,f=0,v=74,b=192;if(w>9&&20>w&&(f=c.bronze),w>19&&30>w&&(f=c.silver),w>29&&40>w&&(f=c.gold),w>39&&(f=c.platinum),M||(s_numberB.draw(h,o/2-s_numberB.width*i/2,20,w),setTimeout(function(){M=!0},200)),G||(s_numberB.draw(h,o/2-s_numberB.width*i/2,20,w),setTimeout(function(){G=!0},1e3)),M&&(k+=.2,k<Math.PI?s_text.GameOver.draw(h,t-s_text.GameOver.width/2,r-5*Math.sin(k)):s_text.GameOver.draw(h,t-s_text.GameOver.width/2,r)),G)if(A+=4,50>A)switch(y.play(),s_score.draw(h,t-s_score.width/2,n+50-A),s_numberS.draw(h,250-s_numberS.width*i,n+85-A,0),s_numberS.draw(h,250-s_numberS.width*a,n+125-A,_),f){case c.bronze:s_medal.bronze.draw(h,v,b+50-A);break;case c.silver:s_medal.silver.draw(h,v,b+50-A);break;case c.gold:s_medal.gold.draw(h,v,b+50-A);break;case c.platinum:s_medal.platinum.draw(h,v,b+50-A)}else switch(u%2==0&&(B=B++<w?B:w),s_score.draw(h,t-s_score.width/2,n),s_numberS.draw(h,250-s_numberS.width*s,n+g,B),s_numberS.draw(h,250-s_numberS.width*a,n+p,_),f){case c.bronze:s_medal.bronze.draw(h,v,b);break;case c.silver:s_medal.silver.draw(h,v,b);break;case c.gold:s_medal.gold.draw(h,v,b);break;case c.platinum:s_medal.platinum.draw(h,v,b)}}}var r,h,n,o,d,m,l=0,u=0,w=0,_=0,g=0,p=100,c={none:0,bronze:1,silver:2,gold:3,platinum:4},f=new Audio("sfx/sfx_die.ogg"),v=new Audio("sfx/sfx_hit.ogg"),b=new Audio("sfx/sfx_point.ogg"),y=new Audio("sfx/sfx_swoosh.ogg"),x=[],S=6,M=!1,G=!1,k=0,A=0,B=0,j={Splash:0,Game:1,Score:2},z={x:60,y:0,frame:0,animation:[0,1,2,1],radius:10,rotation:0,velocity:0,gravity:.25,_jump:4.6,jump:function(){this.velocity=-this._jump,x[g++%S].play()},update:function(){var t=m===j.Splash?10:5;this.frame+=u%t===0?1:0,this.frame%=this.animation.length,m===j.Splash?(this.y=d-280+5*Math.sin(u/t),this.rotation=0):(this.velocity+=this.gravity,this.y+=this.velocity,this.y>=d-(s_fg.height+z.radius)&&(this.y=d-(s_fg.height+z.radius),m===j.Game&&(v.play(),m=j.Score)),this.velocity>=this._jump?(this.frame=1,this.rotation=Math.min(Math.PI/2,this.rotation),this.rotation+=.1):this.rotation=-.3)},draw:function(t){t.save(),t.translate(this.x,this.y),t.rotate(this.rotation);var e=this.animation[this.frame];s_bird[e].draw(t,-s_bird[e].width/2,-s_bird[e].height/2),t.restore()}},I={_pipes:[],reset:function(){this._pipes=[]},update:function(){if(u%100===0){var t=Math.random();t=t.toString().charAt(t.toString().length-1)%2==0?t:-1*t;var e=d-(1.5*s_pipeSouth.height+1.3*s_fg.height+100*t);this._pipes.push({x:o,y:e,width:s_pipeSouth.width,height:s_pipeSouth.height})}for(var i=0,s=this._pipes.length;s>i;i++){var a=this._pipes[i];if(a.x-=2,0===i){var r=Math.min(Math.max(z.x,a.x),a.x+a.width),h=Math.min(Math.max(z.y,a.y),a.y+a.height),n=Math.min(Math.max(z.y,a.y+a.height+p),a.y+2*a.height+p),l=z.x-r,_=z.y-h,g=z.y-n,c=l*l+_*_,y=l*l+g*g,x=z.radius*z.radius;(x>c||x>y)&&(m=j.Score,v.play(),setTimeout(function(){f.play()},400)),a.x+a.width/2==z.x&&(b.play(),++w)}a.x<-a.width&&(this._pipes.splice(i,1),i--,s--)}},draw:function(t){for(var e=0,i=this._pipes.length;i>e;e++){var s=this._pipes[e];s_pipeSouth.draw(t,s.x,s.y),s_pipeNorth.draw(t,s.x,s.y+p+s.height)}}},O={reset:function(){localStorage.setItem("highscore",Math.max(_,w)||0),_=localStorage.getItem("highscore"),w=0,u=0,M=!1,G=!1,A=0,k=0,B=0}};e()}();